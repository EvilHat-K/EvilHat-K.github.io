<!DOCTYPE html>
<html>
   <head>
   <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="XN4YmHgE76jTp2kNQ9qnsVSApl6yIQBzdyLe0BnbFks" />

    <title>EvilHat -- A Simple Blog | 网络安全中的沧海小记,记一记 - 不忘记 !</title>
    
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/bootstrap-theme.min.css">

  <script src="/js/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/holder.min.js" type='text/javascript'></script>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="canonical" href="http://evilhat-k.github.io/post/cgiemail-exploit/">
  

<link rel="stylesheet" href="/css/bootstrap-toc.min.css" type="text/css">

<script src="/js/bootstrap-toc.min.js" type="text/javascript"></script>
   </head>
   <body data-spy="scroll" data-target="#toc">
     <header class="navbar navbar-default navbar-fixed-top" id="top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://evilhat-k.github.io/">EvilHat -- A Simple Blog</a>
    </div>

    
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
	
	
	<li  ><a href="/">Home</a></li>
	
      </ul>
  </div>
</nav>
</header>

     <div class="jumbotron masthead" role="main">
       <div class="container">
	 <div class="row">
	   <div class="col-sm-3">

		 <nav id="toc" data-spy="affix" data-toggle="toc"></nav>
  </div>

 	   <div class="col-md-8 col-md-offset-2">
	   
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/github.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script>
<script type="text/javascript">
  hljs.initHighlightingOnLoad();
$(document).ready(function() {
  $('pre').each(function(i, block) {
  hljs.highlightBlock(block);
  });
});
</script>

<div class="panel panel-default">
  <div class="panel-body">
      <div itemscope  id="post" >
	<p><h1 data-toc-skip itemprop="name"> Cgiemail漏洞记录 </h1>
	  
	  <small class="text-muted">
	  EvilHat-K  posted by:&nbsp;<time itemprop="datePublished"  content="Sat Dec 17,17126"  datetime="2016-12-17 19:07:18 &#43;0800 CST" itemprop="datePublished">Sat Dec 17, 2016 </time>
	  </small>
	</p>

	<p>
	  
	  <a href='/'><span class="label label-danger"></span></a>

	</p>


	<hr/>
	<span itemprop="articleBody">
	  <p>最近在测试的过程中,记录了一个应用的漏洞,这个应用通常用在了cpanel(虚拟主机管理面板).这次碰到了就记录一下吧,免得以后又忘记了.</p>

<p>cgiemail的作用简单说就是通过webcgi的方式来发送email,具体的这里不多赘述.想了解的到 <a href="http://web.mit.edu/wwwdev/cgiemail/">项目地址</a>.</p>

<blockquote>
<p>现在我找到的关于这个程序的2个漏洞<br />
  1. <a href="https://www.exploit-db.com/exploits/21998/">CGIEmail 1.6 - 远程缓冲区溢出</a><br />
  2. <a href="https://www.exploit-db.com/exploits/40571">CGIEmail 1.6 - 源代码泄露</a></p>
</blockquote>

<hr />

<ul>
<li>先说下这个缓冲区溢出吧.具体的细节我也不太清楚,因为现在对缓冲区溢出这方面还不太了解,也不敢来分析什么的.以后接触到了可以拿来分析看看吧.<br />
&gt; 这个缓冲区漏洞问题出现在 <strong>cgicso</strong> 中,这个是cgiemail编译后生成的4个文件之一.应该这个漏洞的披露时间是2001年左右,比较老了.现在很少会出现这个漏洞了.但是可以在测试的时候也尝试下.<br />
&gt; 通常这个程序用于流行的虚拟主机管理面板 cpanel中,在测试的时候,随便找一个使用这个虚拟主机机器的站点,在url后面加上 /cgi-sys/cgicso 或者 /cgi-bin/cgicso 一般都是这2个访问点.只要返回的信息不是没有这个程序,就说明 <strong>存在该文件</strong> 因为这个漏洞现在几乎找不到了,我也没有找到例子,只能通过网上的资料来写.<br />
&gt; 在确人了该程序存在后,如果要利用这个漏洞还有一个前提条件.就是目标服务是否允许请求到远程主机. 可以发送一个GET请求来测试.<a href="https://tools.cisco.com/security/center/viewAlert.x?alertId=5012">参考</a><br />
<strong>GET /cgi-sys/cgisco?fingerhost=A&amp;query=AAA</strong></li>
</ul>

<hr />

<ul>
<li>接下来讲下源代码泄露这个漏洞.漏洞出现在cgiecho中,url访问点依旧和上面说的一样,不是/cgi-bin/ 就是 /cgi-sys/. 本来这个程序的作用是用于把email模板和传入的参数值输出到页面上,便于查看 <a href="http://web.mit.edu/wwwdev/cgiemail/user.html#cgiecho">官网介绍</a><br />
&gt; 但是它没有对传入email模板文件进行限制,导致我们可以传入当前站点根目录的任意一个文件作为email模板文件, 但是仅仅传入文件名,并不会泄露文件的内容.我们可以看看官网给的一个email模板文件的<a href="http://web.mit.edu/wwwdev/cgiemail/questions3.txt">例子</a><br />
<img src="/images/20161217/cgiemail-1.png" alt="email模板例子" /><br />
&gt; 通过说明和例子可以知道,如果要正常输出email文件的内容,除了文件要存在,还要传入一个 <strong>参数</strong> 这个参数就是例子中用方括号包起来的字符 [email],[yourname],[quest],[colour].如果我们提交了如下请求,那么文件的内容就会输出,而方括号里的内容就会被传入的对应值填充 <br >
<strong>GET /cgi-sys/cgiecho/test.txt?email=demo</strong><br />
&gt; 这时候页面就输出文件的内容了.<br />
&gt; 注意:传入的参数必须和文件里方括号里的内容一致,如果文件里是 [&lsquo;email&rsquo;]这种,在请求里也要对应为?&lsquo;email&rsquo;=test.传入的值随意,只要不为空就可以. 这里test.txt对应的位置就是站点的根目录位置,如果文件在比如 demo/这个目录,同样加上目录/cgiecho/demo/test.txt就可以了.<br />
&gt; 知道了问题的原因和利用的条件,就可以去利用了. 这个漏洞有一点就是很坑,要成功利用,需要文件里有中括号包含的内容,就是有中括号,但是中括号里的内容就要靠猜了.不过通常的知道传入的参数还是挺好猜的,或者全站爬行一遍,就能找到很多参数了.注意:利用成功后会输出文件的内容,但其他包含中括号的内容如果没有猜解到,则会返回空.比如文件内有$str[&lsquo;te&rsquo;]和$str[&rsquo;s&rsquo;],如果传入test.php?&lsquo;te&rsquo;=[&lsquo;te123&rsquo;],那么就会返回$str[&lsquo;te123&rsquo;]和$str. 后面那个中括号里的内容就消失了,因为没有赋值.<br />
&gt; 这里附上个老外写的利用脚本 <a href="https://github.com/finbar-crago/cgiemail-exploit">https://github.com/finbar-crago/cgiemail-exploit</a></li>
</ul>

	</span>

	
	<hr/>
<p>
  
    <strong>Categories</strong>:


	  
	<a class="btn btn-default btn-xs" href="/categories/%E6%BC%8F%E6%B4%9E%E8%AE%B0%E5%BD%95">漏洞记录</a>
	

	<br/>
	
	
<strong>Tags:</strong>
  <a class=" label label-danger" href="/tags/cgiemail">cgiemail</a> <a class=" label label-danger" href="/tags/cpanel">cpanel</a> <a class=" label label-danger" href="/tags/%E6%BA%90%E7%A0%81%E6%B3%84%E9%9C%B2">源码泄露</a>


		

	
	



      </div>
      </div></div>


	 </div>

	 </div>
       </div>
     </div>

 <div class="container footer">
  <div class="row">
    <div class="col-md-10">
      <small class="text-muted"> Theme:<a href="https://feiio.com/">eiio</a></small>
    </div>
    <div class="col-md-2">
      <small class="text-muted"></small>
      </div>
   </div>
 </div>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'google analytics code', 'auto');
ga('send', 'pageview');
</script>

</body></html>
